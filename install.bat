@echo off
title Sovereign OS Installer
color 0A
chcp 65001 >nul

echo ????????????????????????????????????????????????????????????
echo ?     ?? Sovereign OS - One-Click Install                   ?
echo ????????????????????????????????????????????????????????????
echo.

:: Check Python
python --version >nul 2>&1
if %errorlevel% neq 0 (
    echo ? Python 3.10+ not found. Install from python.org
    pause & exit /b 1
)
echo ? Python: %python --version%

:: Check Bun
where bun >nul 2>&1
if %errorlevel% neq 0 (
    echo ??  Bun not found. Installing via npm...
    npm install -g bun
)
echo ? Bun ready

:: Install dependencies
echo.
echo ?? Installing Python packages...
pip install -q psutil requests duckduckgo_search torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

echo ?? Installing Node packages with Bun...
bun install lucide-react

:: Create .env if missing
if not exist .env (
    echo.
    echo ?? Creating .env...
    (
        echo # Sovereign OS Config
        echo # OPENAI_API_KEY=sk-...  ^(optional for cloud fallback^)
        echo PYTHON_BACKEND_URL=http://localhost:8000
        echo MAX_VRAM_GB=10
    ) > .env
)

echo.
echo ????????????????????????????????????????????????????????????
echo ?     ? Installation Complete!                             ?
echo ????????????????????????????????????????????????????????????
echo.
echo ?? Start with: .\rez-control.bat
echo ?? Open: http://localhost:3001
echo.
pause
